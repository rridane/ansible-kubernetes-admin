# Ansible Collection: rridane.kubernetes_admin

This collection groups a set of Ansible roles to **administer a Kubernetes cluster** with `kubeadm`.  
The goal is to simplify cluster node installation and management operations through specialized roles.

---

## 📦 Available Roles

### 🔹 `k8s_bootstrap_control_plane`
Bootstraps the **primary control-plane** via `kubeadm init`.
- Generates and applies a `kubeadm.yaml`.
- Creates a `kubeconfig` for root (and optionally for a user).
- Prepares the cluster to receive workers and additional control-planes.

👉 [See the role documentation](roles/k8s_bootstrap_control_plane/README.md)

---

### 🔹 `k8s_get_join_command`
Generates the `kubeadm join` commands to be executed on other nodes:
- **worker** (simple `join`)
- **additional control-plane** (`join --control-plane --certificate-key=...`).

👉 [See the role documentation](roles/k8s_get_join_command/README.md)

---

### 🔹 `k8s_manage_master_nodes`
Allows joining a node as an **additional control-plane** from the command generated by `k8s_get_join_command`.
- Executes the `kubeadm join ... --control-plane`.
- Ensures the `kubelet` service is started.

👉 [See the role documentation](roles/k8s_manage_master_nodes/README.md)

---

### 🔹 `k8s_manage_worker_nodes`
Allows joining a node as a **worker** in the cluster.
- Executes the `kubeadm join ...`.
- Ensures the `kubelet` service is started.

👉 [See the role documentation](roles/k8s_manage_worker_nodes/README.md)

---

## 🚀 Usage Example

Here is a typical workflow using the collection:

```yaml
- name: Cluster bootstrap (primary control-plane)
  hosts: masters[0]
  become: yes
  roles:
    - role: rridane.kubernetes_admin.k8s_bootstrap_control_plane

- name: Generate join commands
  hosts: masters[0]
  become: yes
  roles:
    - role: rridane.kubernetes_admin.k8s_get_join_command

- name: Join additional control-planes
  hosts: masters[1:]
  become: yes
  roles:
    - role: rridane.kubernetes_admin.k8s_manage_master_nodes

- name: Join workers
  hosts: workers
  become: yes
  roles:
    - role: rridane.kubernetes_admin.k8s_manage_worker_nodes
```

## Compatibility

OS: Debian 12+, Ubuntu 20.04/22.04

Ansible: ≥ 2.15

Kubernetes: tested with kubeadm ≥ 1.26

Requires become: true for most operations.

## 🛠 Dependencies

Kubernetes packages (kubeadm, kubelet, kubectl) must be installed beforehand (e.g., via a role such as kube_packages).

A CNI (Calico, Cilium, Flannel…) must be deployed after initialization so Pods can communicate.

## 📌 Important Note

This collection is under construction 🏗️.  
👉 Before the first official release, please directly consult each role's documentation (README.md in each folder) for detailed variables and usage.

## 📜 License

Apache-2

👤 Author  
Maintained by rridane
